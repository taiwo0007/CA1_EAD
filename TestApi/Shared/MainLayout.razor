@inherits LayoutComponentBase
@using System.Text.Json.Nodes
@using System.Security.Principal
@inject HttpClient Http
@inject System.Net.Http.Headers.MediaTypeWithQualityHeaderValue headers

<style>
*{

overflow-x: hidden;

}
    #country{
        position: fixed;
        border-bottom: 1px solid rgba(118, 120, 120, 0.58);
        border-top: 0px solid;
        border-left: 0px solid;
        border-right: 0px solid;
        width: 12%;
        transition: 0.2s ease-in-out;
    }
    #country:focus{
        border-bottom: 3px solid black;
    
    }
     #home-search{
    
              border-bottom: 1px solid rgba(118, 120, 120, 0.58);
              border-top: 0px solid;
              border-left: 0px solid;
              border-right: 0px solid;
              width: 33rem;
              font-size: 4rem;
            
              transition: 0.2s ease-in-out;
          }
          #home-search::placeholder{
              color: rgba(0, 0, 0, 0.149);
          
          }
          #home-search:focus{
              border-bottom: 3px solid black;
          
          }
</style>

@if (weatherApiModel.locationName == null)
{
    <div style="height: 100vh !important; margin: auto auto !important;" class="container-fluid  text-center">

        <div style="padding-top: 30vh !important;" >
            
            <EditForm Model="@weatherApiModel" OnValidSubmit="@HandleValidSubmit">
                <DataAnnotationsValidator />
                <ValidationSummary />
                <InputText @bind-Value="weatherApiModel.PlaceName" id="home-search" class="mt-auto" type="text" placeholder="Enter place name" /><br/>
                               <button style="width: 33rem;" class="btn btn-dark mt-3" type="submit"> submit</button>

                
            </EditForm>
            
        </div>
    </div>

    
    
}
else
{
    
    <div style="height: 100vh !important;" class="container-fluid row">
        <!-- https://dribbble.com/shots/10460680-Weather-App -->

        <div class="col-3 p-5">
        
            <EditForm Model="@weatherApiModel" OnValidSubmit="@HandleValidSubmit">
                <DataAnnotationsValidator />
                <ValidationSummary />
                <InputText id="country" @bind-Value="weatherApiModel.PlaceName" placeholder="Enter place name" type="text" />
                <button type="submit" style="width: 50%;" class="btn btn-dark mt-5 text-center mx-auto">Submit</button>

            </EditForm> 
            <div style="height: 90vh">
                <div>
                    <img class="pt-5" width="200" src="./images/weathervector.png" alt="">
                </div>
                <div>
                    <p > <span style="font-size: 6rem">@weatherApiModel.temperature</span>  °C</p>
                </div>
                <div>
                    <p style="font-size: 1.5rem"><span class="fw-bold">@DateTime.Now.DayOfWeek</span>, <span class="text-secondary">@DateTime.Now.Hour:@DateTime.Now.Minute</span></p>
                </div>
                <div class="mt-5 pt-4">
                    <div class="d-flex align-items-center">
                        <img class="me-3" width="40" src="@weatherApiModel.conditionIcon">
                        <p style="margin: 0 !important" class="fw-bold">Condition: <span>@weatherApiModel.conditionText</span> </p>
                    </div>
                    <div class="d-flex align-items-center">
                        <img class="me-3" width="40" src="https://img.icons8.com/arcade/64/null/heavy-rain.png" alt="">
                        <p style="margin: 0 !important" class="fw-bold">Humidity -<span> @weatherApiModel.humidity%</span> </p>
                    </div>
                </div>

                <div style="
        background-image: url('./images/header.png');
      " class="bg-info p-4  rounded mt-5">
                    <div class="my-auto">
                        <p style="font-size: 1.2rem !important;" class="my-auto text-light text-center fw-bold">
                            <span class="text-light">@weatherApiModel.countryName</span>, 
                            <span>@weatherApiModel.locationName</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-9 bg-light p-5">
            <div >
                <div class="d-flex align-items-center">
                    <p class="h4">Forcast: </p> 
                    <p class="h4 ps-4 fw-bold">@weatherApiModel.countryName -</p> 
                    <p class="h4 ps-1 ">@weatherApiModel.localTimeFromApiFormatted</p>
                </div>
                <div class="row g-5">
                    <div class="col-4">
                        <div class="p-3 bg-white rounded">
                            <p style="color: rgba(0, 0, 0, 0.305) !important" class="text-secondary">UV Index</p>
                            <div class="text-center p-3">
                                <p class="h1 fw-bold">@weatherApiModel.uvIndex</p> 
                                <div class="progress">
                                    <div class="progress-bar bg-warning" role="progressbar" aria-label="Warning example" style="width: 75%" aria-valuenow="@weatherApiModel.uvIndex" aria-valuemin="0" aria-valuemax="10"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="p-3 bg-white rounded">
                            <p style="color: rgba(0, 0, 0, 0.305) !important" class="text-secondary">Precipitation</p>
                            <div class="text-center p-3">
                                <p><span class="h1 fw-bold">@weatherApiModel.precipitation</span>  mm</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="p-3 bg-white rounded">
                            <p style="color: rgba(0, 0, 0, 0.305) !important" class="text-secondary">Humidity</p>
                            <div class="text-center p-3">
                                <p><span class="h1 fw-bold"> @weatherApiModel.humidity</span>  %</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row g-5 mt-1">
                    <div class="col-4">
                        <div class="p-3 bg-white rounded">
                            <p style="color: rgba(0, 0, 0, 0.305) !important" class="text-secondary">Wind</p>
                            <div class="text-center p-3">
                                <p><span class="h1 fw-bold text-primary">@weatherApiModel.windMph</span>  mph</p> 
    
                            </div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="p-3 bg-white rounded">
                            <p style="color: rgba(0, 0, 0, 0.305) !important" class="text-secondary">Wind degree</p>
                            <div class="text-center p-3">
                                <p><span class="h1 fw-bold text-primary">@weatherApiModel.windDegree</span>  °</p> 
    
                            </div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="p-3 bg-white rounded">
                            <p style="color: rgba(0, 0, 0, 0.305) !important" class="text-secondary">Wind Direction</p>
                            <div class="text-center p-3">
                                <p><span class="h1 fw-bold text-primary">
                                    @weatherApiModel.windDirection <i class="fa fa-compass text-danger" aria-hidden="true"></i></span> </p> 
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row g-5 mt-1">
                    <div class="col-4">
                        <div class="p-3 bg-white rounded">
                            <p style="color: rgba(0, 0, 0, 0.305) !important" class="text-secondary">Pressure</p>
                            <div class="text-center p-3">
                                <p><span class="h1 fw-bold text-info">@weatherApiModel.pressure</span>  in</p> 

                            </div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="p-3 bg-white rounded">
                            <p style="color: rgba(0, 0, 0, 0.305) !important" class="text-secondary">Gust</p>
                            <div class="text-center p-3">
                                <p><span class="h1 fw-bold">
                                    @weatherApiModel.gust </span> mph</p> 

                            </div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="p-3 bg-white rounded">
                            <p style="color: rgba(0, 0, 0, 0.305) !important" class="text-secondary">Feels Like</p>
                            <div class="text-center p-3">
                                <p><span class="h1 fw-bold">
                                    @weatherApiModel.feelsLike °C</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
@code {
    
    //Values kept ot just string as we do not need to do any calculations with the returned values
    //but to just display it to the user upon valid form submission
    
    private WeatherApiModel weatherApiModel = new WeatherApiModel();
    
    
    protected override async Task OnInitializedAsync()
    {
        Http.DefaultRequestHeaders.Add("X-RapidAPI-Key", "7ac8da929cmsh5be541b7b0dc3c8p18afb3jsn65ff0d02c66c");
        Http.DefaultRequestHeaders.Add("X-RapidAPI-Host", "weatherapi-com.p.rapidapi.com");
        Http.DefaultRequestHeaders.Accept.Add(headers);
    }
    private void HandleValidSubmit()
    {
        callApi(weatherApiModel.PlaceName);
    }

    protected async Task callApi(String country)
    {
        var json = await Http.GetAsync($"https://weatherapi-com.p.rapidapi.com/current.json?q='{country}");
        String responseBody = await json.Content.ReadAsStringAsync();

        var jsonObject = JsonNode.Parse(responseBody).AsObject();
        
        weatherApiModel.locationName = jsonObject["location"]["name"].ToString();
        weatherApiModel.regionName = jsonObject["location"]["region"].ToString();
        weatherApiModel.countryName = jsonObject["location"]["country"].ToString();
        weatherApiModel.temperature = jsonObject["current"]["temp_c"].ToString();
        weatherApiModel.localTimeFromApi = jsonObject["location"]["localtime"].ToString();
        weatherApiModel.localTimeFromApiFormatted = weatherApiModel.localTimeFromApi.Substring(weatherApiModel.localTimeFromApi.Length - 5);
        
        weatherApiModel.conditionIcon = jsonObject["current"]["condition"]["icon"].ToString();
        weatherApiModel.conditionText = jsonObject["current"]["condition"]["text"].ToString();
        
        weatherApiModel.windMph = jsonObject["current"]["wind_mph"].ToString();
        weatherApiModel.windDegree = jsonObject["current"]["wind_degree"].ToString();
        weatherApiModel.windDirection = jsonObject["current"]["wind_dir"].ToString();
        weatherApiModel.pressure = jsonObject["current"]["pressure_in"].ToString();
        weatherApiModel.humidity = jsonObject["current"]["humidity"].ToString();
        weatherApiModel.precipitation = jsonObject["current"]["precip_in"].ToString();
        weatherApiModel.feelsLike = jsonObject["current"]["feelslike_c"].ToString();
        weatherApiModel.uvIndex = jsonObject["current"]["uv"].ToString();
        weatherApiModel.gust = jsonObject["current"]["gust_mph"].ToString();
        
    }

  
}

